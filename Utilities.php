<?php
session_start();
//error_reporting(0);

class Core{
	protected $requested_exploit;
	protected $conn;
	protected $result;
	protected $field;
	protected $db_host;
	protected $db_user;
	protected $db_pass;
	protected $db_name;
	protected $link;
	protected $POSTEDuser;
	protected $POSTEDpass;
	protected $key;

	function __construct() {
		$this->db_host = "localhost";
		$this->db_user = "User";
		$this->db_pass = "nospecialp3rm$";
		$this->db_name = "exploitmarket";
		$this->key = "SXVsbrE9E569QDZgt2D5JvU8NdcMvcbWCaeXuuf57gaduA7E4Z";
	}
	protected function GetIdividualInfo($name, $info) {
		$this->requested_exploit = $name;
		if ($this->requested_exploit != NULL) {
			$this->conn = new mysqli($this->db_host, $this->db_user, $this->db_pass, $this->db_name);
			$this->result = $this->conn->query("SELECT * FROM exploits WHERE exploit_name='$this->requested_exploit'");
			$this->field = $this->result->fetch_array();
			if ($this->field != NULL) {
				return $this->field[$info];
			} else {
				return "";
			}
			$this->conn->close();
		} else {
			return "";
		}
	}

	protected function CheckAuthenticity($username, $password, $choice) {
		if ($username != NULL && $password != NULL) {
			$this->conn = new mysqli($this->db_host, $this->db_user, $this->db_pass, $this->db_name);
			if ($choice	== 1) {
				$this->result = $this->conn->query("SELECT * FROM logins WHERE username='$username'");
				$this->field = $this->result->num_rows;
				if ($this->field > 0) {
					return true;
				} else {
					return false;
				}
			}
			if ($choice	== 2) {
				$this->result = $this->conn->query("SELECT username FROM logins WHERE username='$username' AND password='$password'");
				$this->field = $this->result->num_rows;
				if ($this->field > 0) {
					$this->field = $this->result->fetch_array();
					return $this->field[0];
				} else {
					return false;
				}
			}
			$this->conn->close();
		} else {
			return false;
		}
	}

	protected function CheckForCookie($cookie, $choice) {
		if ($cookie != NULL) {
			if ($choice == 1) {
				$this->conn = new mysqli($this->db_host, $this->db_user, $this->db_pass, $this->db_name);
				$this->result = $this->conn->query("SELECT cur_cookie FROM logins WHERE cur_cookie='$cookie'");
				$this->field = $this->result->fetch_array();
				if ($this->field != NULL) {
					return $this->field[0];
				} else {
					return false;
				}
				$this->conn->close();
			}
			if ($choice == 2) {
				$this->conn = new mysqli($this->db_host, $this->db_user, $this->db_pass, $this->db_name);
				$this->result = $this->conn->query("SELECT username FROM logins WHERE cur_cookie='$cookie'");
				$this->field = $this->result->fetch_array();
				if ($this->field != NULL) {
					return $this->field[0];
				} else {
					return false;
				}
				$this->conn->close();
			}
		} else {
			return false;
		}
	}

	protected function RegisterUserAccount($username, $password) {
		if ($username != NULL && $password != NULL) {
			$this->conn = new mysqli($this->db_host, $this->db_user, $this->db_pass, $this->db_name);
			if ($this->result = $this->conn->query("INSERT INTO logins (username, password, owned_exploits, cur_cookie) VALUES ('$username', '$password', 'none', '')")) {
			} else {
				return false;
			}
			$this->conn->close();
		} else {
			return false;
		}
	}

	protected function RegisterCookie($username, $password, $cookie) {
		if ($username != NULL && $password != NULL) {
			$this->conn = new mysqli($this->db_host, $this->db_user, $this->db_pass, $this->db_name);
			if ($this->conn->query("UPDATE logins SET cur_cookie='$cookie' WHERE username='$username' AND password='$password'")) {
				return true;
			} else {
				return false;
			}
			$this->conn->close();
		} else {
			return false;
		}
	}
	
	protected function CreateCookie($username, $password) {
		//$cookie = password_hash($username + $password, PASSWORD_BCRYPT, $this->key);
		$hash1 = hash('gost-crypto', $username . $password . $this->key);
		$hash2 = hash('sha256', $username . $password . $this->key);
		$hash3 = hash('sha512', $username . $password . $this->key);
		$hash4 = hash('joaat', $username . $password . $this->key);
		$hash5 = hash('adler32', $username . $password . $this->key);
		$hash6 = hash('snefru256', $username . $password . $this->key);
		$hash7 = hash('ripemd320', $username . $password . $this->key);
		$hash8 = hash('whirlpool', $username . $password . $this->key);
		$hash9 = hash('gost', $username . $password . $this->key);
		$hash10 = hash('fnv1a64', $username . $password . $this->key);
		$cookie = $hash2 + $hash6 . $hash10 . $hash4 . $hash1 . $hash8 . $hash9 . $hash3 . $hash5 . $hash7;
		return $cookie;
	}
}

class ExploitInformation extends Core{
	public function GetExploitName($exploit) {
		return $this->GetIdividualInfo($exploit, 0);
	}
	public function GetExploitType($exploit) {
		return $this->GetIdividualInfo($exploit, 1);
	}
	public function GetExploitDescription($exploit) {
		return $this->GetIdividualInfo($exploit, 2);
	}
	public function GetExploitPrice($exploit) {
		return $this->GetIdividualInfo($exploit, 3);
	}
	public function GetExploitStatus($exploit) {
		return $this->GetIdividualInfo($exploit, 4);
	}
	public function GetExploitAuthor($exploit) {
		return $this->GetIdividualInfo($exploit, 5);
	}
	public function GetExploitThread($exploit) {
		$this->link = $this->GetIdividualInfo($exploit, 6);
		if (substr($this->link, 0, 4) == "http") {
			return "<a target='_blank' href='$this->link'>V3rmillion</a>";
		} else {
			return $this->link;
		}
	}

}
?>