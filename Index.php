<!DOCTYPE html>
<html>
	<head>
		<title>Exploit Market</title>
		<link rel="stylesheet" href="Resources/Bootstrap/css/bootstrap.min.css">
		<link rel="stylesheet" href="Style.css">
		<script src="Resources/JS/jsUri.js"></script> <!--https://github.com/derek-watson/jsUri-->
		<script src="Resources/JS/jquery-3.2.1.min.js"></script>
		<script src="Resources/JS/js.cookie.js"></script>
		<script src="Resources/Bootstrap/js/bootstrap.min.js"></script>
		<?php include 'Account.php';?>

		<?php
			//print_r(hash_algos());
			if (filter_input(INPUT_POST, "login") == "yes") {
				$Run = new Authentication();
				$Run->AuthenticateUser();
			}
			if (filter_input(INPUT_POST, "register") == "yes") {
				$Run = new Registration();
				$Run->RegisterUser();
			}
		?>
		<script type="text/javascript">
			function getParameterByName(name) {
			    var match = RegExp('[?&]' + name + '=([^&]*)').exec(window.location.search);
			    return match && decodeURIComponent(match[1].replace(/\+/g, ' '));
			}

			var tab = window.location.search.substring(0, 5)
			if (tab != "?tab=") {
				window.location.search = "?tab=1";
			}


			//Tab managing!!!1!!11!
			function SetTab(tabnum) {
				var params = window.location.search;
				window.location.search = params.replace(params.substring(5, 6), tabnum.toString());
				ManageTabs();
			}
			function ManageTabs() {
				console.log("Managing Tabs!");
				var curtab = parseInt(window.location.search.substring(5, 6));
				if (curtab == 1) {
					console.log("Tab changed to 1!");
					$('#tab1').css("backgroundColor", "#878787");
					$('#tab2').css("backgroundColor", "transparent");
					$('#tab3').css("backgroundColor", "transparent");
					$('#tab4').css("backgroundColor", "transparent");
					$('#AboutTab').show('fade');
					$('#ExploitSearchTab').hide('fade');
					$('#SocialTab').hide('fade');
				}
				if (curtab == 2) {
					console.log("Tab changed to 2!");
					$('#tab1').css("backgroundColor", "transparent");
					$('#tab2').css("backgroundColor", "#878787");
					$('#tab3').css("backgroundColor", "transparent");
					$('#tab4').css("backgroundColor", "transparent");
					$('#AboutTab').hide('fade');
					$('#ExploitSearchTab').show('fade');
					$('#SocialTab').hide('fade');
				}
				if (curtab == 3) {
					console.log("Tab changed to 3!");
					$('#tab1').css("backgroundColor", "transparent");
					$('#tab2').css("backgroundColor", "transparent");
					$('#tab3').css("backgroundColor", "#878787");
					$('#tab4').css("backgroundColor", "transparent");
					$('#AboutTab').hide('fade');
					$('#ExploitSearchTab').hide('fade');
					$('#SocialTab').show('fade');
				}
				if (curtab == 4) {
					console.log("Tab changed to 4!");
					$('#tab1').css("backgroundColor", "transparent");
					$('#tab2').css("backgroundColor", "transparent");
					$('#tab3').css("backgroundColor", "transparent");
					$('#tab4').css("backgroundColor", "#878787");
					$('#AboutTab').hide('fade');
					$('#ExploitSearchTab').hide('fade');
					$('#SocialTab').hide('fade');
				}
			}

			//SerchBar stuff!!11!1!!!1
			$(document).ready(function() {
				$('#ExploitSearchBar').focus();
				console.log("Page has finished loading!");
				if (window.location.search.substring(7, 15) != "") {
					if (getParameterByName("exploit") != "") {
						console.log("GET Value is not NULL!");
						if ("<?php $Run = new ExploitInformation(); echo $Run->GetExploitName(filter_input(INPUT_GET, 'exploit')); ?>" == "") {
							console.log("Search failed, Showing Error!");
							$('#ErrorMessage').show('fade');
						}
					}
				}
				$('#CloseAlert').click(function() {
						console.log("Dismissing Error!");
						$('#ErrorMessage').hide('fade');
				});
			});



			//Cookie stuff!!11!1!!!1
			$(document).ready(function() {
				if (Cookies.get("EMAcct")) {
					console.log("User Cookie found!");
					if ("<?php $Run = new CookieManager(); echo $Run->CheckCookie(); ?>" != false) {
						console.log("Cookie is valid!");
						$('.NotLoggedIn').hide();
						$('.LoggedIn').show();
						$('#usernameprofilebar').html("<?php $Run = new CookieManager(); echo $Run->CheckCookie(); ?>")
						$('#logoutbtn').click(function() {
							//<?php //$Run = new CookieManager(); $Run->RemoveCookie(); ?>
							console.log("Logging Out...");
							Cookies.remove('EMAcct');
							location.reload();
						})
					}
					else {
						Cookies.remove('EMacct');
					}
				}
				if (!Cookies.get("EMAcct")) {
					console.log("User Cookie not found!");
					$('.NotLoggedIn').show();
					$('.LoggedIn').hide();
					$('#Login').click(function() {
						$('#BlurEffect').css({"-webkit-filter":"blur(4px)", "-moz-filter":"blur(4px)", "-ms-filter":"blur(4px)", "-o-filter":"blur(4px)"});
						$('#LoginContainer').show('fade');
						$('.logincancelbtn').click(function() {
							$('#BlurEffect').css({"-webkit-filter":"blur(0px)", "-moz-filter":"blur(0px)", "-ms-filter":"blur(0px)", "-o-filter":"blur(0px)"});
							//$('#LoginContainer').hide('fade');
						});
						$('#Register').click(function() {
							$('#LoginContainer').hide('fade');
							$('#RegisterContainer').show('fade');
							$('.registercancelbtn').click(function() {
								$('#BlurEffect').css({"-webkit-filter":"blur(0px)", "-moz-filter":"blur(0px)", "-ms-filter":"blur(0px)", "-o-filter":"blur(0px)"});
								$('#RegisterContainer').hide('fade');
							});
						});
					});
					$('#Register').click(function() {
						$('#BlurEffect').css({"-webkit-filter":"blur(4px)", "-moz-filter":"blur(4px)", "-ms-filter":"blur(4px)", "-o-filter":"blur(4px)"});
						$('#RegisterContainer').show('fade');
						$('.registercancelbtn').click(function() {
							$('#BlurEffect').css({"-webkit-filter":"blur(0px)", "-moz-filter":"blur(0px)", "-ms-filter":"blur(0px)", "-o-filter":"blur(0px)"});
							$('#RegisterContainer').hide('fade');
						});
						$('#Login').click(function() {
							$('#RegisterContainer').hide('fade');
							$('#LoginContainer').show('fade');
							$('.logincancelbtn').click(function() {
								$('#BlurEffect').css({"-webkit-filter":"blur(0px)", "-moz-filter":"blur(0px)", "-ms-filter":"blur(0px)", "-o-filter":"blur(0px)"});
								$('#LoginContainer').hide('fade');
							});
						});
					});
				}
			});



		</script>
	</head>

	<body id="Body" onload="ManageTabs();">
		<div id="LoginRegister">
			<center>
				<div id="LoginContainer" class="container collapse">
					<div id="LoginPanel" class="panel">
						<div class="panel-heading">
							<h2>Login</h2>
						</div>
						<div class="panel-body">
							<form class="form" action="index.php" method="post">
								<div class="form-group">
									<label>Username</label>
									<div class="input-group form-inline">
										<span class="input-group-addon glyphicon-backround"><span class="glyphicon glyphicon-user"></span></span>
										<input id="usernamelogin" class="form-control no-left-border" type="text" name="username">
									</div>
									<label id="margin-top5px">Password</label>
									<div class="input-group form-inline">
										<span class="input-group-addon glyphicon-backround"><span class="glyphicon glyphicon-lock"></span></span>
										<input id="passwordlogin" class="form-control no-left-border" type="password" name="password">
									</div>
									<div class="form-inline">
										<input type="hidden" name="login" value="yes">
										<button class="btn btn-danger logincancelbtn" id="margin-top5px">Cancel</button>
										<button type="submit" class="btn btn-danger loginbtn" id="margin-top5px">Login</button>
									</div>
								</div>
							</form>
						</div>
					</div>
				</div>
				<div id="RegisterContainer" class="container collapse">
					<div id="RegisterPanel" class="panel">
						<div class="panel-heading">
							<h2>Register</h2>
						</div>
						<div class="panel-body">
							<form class="form" action="index.php" method="post">
								<div class="form-group">
									<label>Username</label>
									<div class="input-group form-inline">
										<span class="input-group-addon glyphicon-backround"><span class="glyphicon glyphicon-user"></span></span>
										<input class="form-control no-left-border" type="text" name="username">
									</div>
									<label id="margin-top5px">Password</label>
									<div class="input-group form-inline">
										<span class="input-group-addon glyphicon-backround"><span class="glyphicon glyphicon-lock"></span></span>
										<input class="form-control no-left-border" type="password" name="password">
									</div>
									<div class="form-inline">
										<input type="hidden" name="register" value="yes">
										<button class="btn btn-danger registercancelbtn" id="margin-top5px">Cancel</button>
										<button type="submit" class="btn btn-danger registerbtn" id="margin-top5px">Register</button>
									</div>
								</div>
							</form>
						</div>
					</div>
				</div>
			</center>
		</div>
		<div id="BlurEffect">
			<canvas></canvas>
			<div id="PageHeader">
				<div id="HeaderBar" class="conatiner">
					<div class="ProfileBar">
						<div class="LoggedIn collapse">
							<span id="usernameprofilebar" class="label">Username</span>
							<a id="settingsbtn"><span class="glyphicon glyphicon-cog"></span></a>
							<a id="logoutbtn"><span class="glyphicon glyphicon-log-out"></span></a>
						</div>
						<div class="NotLoggedIn collapse">
							<a id="Login"><span class="label">Login</span></a>
							<a id="Register"><span class="label"> Register</span></a>
						</div>
					</div>
					<header>
						<center>
							<img id="logo" src="Resources/Images/EM Logo 250x250.png">
						</center>
						<ul class="nav">
							<li><a id="tab1" onclick="SetTab(1);"><span class="glyphicon glyphicon-info-sign"></span> About</a></li>
							<li><a id="tab2" onclick="SetTab(2);"><span class="glyphicon glyphicon-search"></span> Search</a></li>
							<li><a id="tab4" onclick="SetTab(4);"><span class="glyphicon glyphicon-envelope"></span> Contact</a></li>
							<li><a id="tab3" onclick="SetTab(3);"><span class="glyphicon glyphicon-phone"></span> Social</a></li>
						</ul>
					</header>
				</div>
			</div>
			<div id="AboutTab" class="collapse">
				<center>
					<div class="panel">
						<div class="panel-heading">
							<h2>Welcome to ExploitMarket!</h2>
						</div>
						<div class="panel-body">
							<h4>Here's a little bit about ExploitMarket! This site is currently undergoing construction and is far from being finished.
							The site you see is generally how the full site will look and function, I plan to add a login/register
							user system so you can track your purchases. ExploitMarket will allow Exploit developers to connect thier
							PayPal email to the site, this will allow poeple to buy the exploit straight from the website rather
							than waiting for the exploit creator to put it onsale manually. An auto-whitelist API is also a possibility
							allowing the Exploit makers to connect thier SQL databse to the site, input the required fields, and require the
							buyers to fill out the fields when they purchase the Exploit. Exploit Creators will have the ability to toggle
							whether a user can purchase thier exploit or not (toggling sales status). Another possible feature would be
							auto-renewal, some (not many) exploits require re-occuring payments to keep your whitelist activated,
							ExploitMarket will instantly charge your PayPal account as soon as its time to renew your whitelist.
							ExploitMarket will keep track of the exploits you own, the downloads for the exploits, and much more!
							This is ExploitMarket and i hope you Enjoy!</h4>
						</div>
						<div class="panel-footer">
							<h3>ExploitMarket by Brxxrs</h3>
						</div>
					</div>
				</center>
			</div>
			<div id="ExploitSearchTab" class="collapse">
				<center>
					<div id="ExploitSelectionForm" class="container">
						<form class="form form-inline" me id="ExploitSearchForm">
							<div class="form-group" id="ExploitSearch">
								<div class="input-group">
									<span class="input-group-addon glyphicon-backround"><span class="glyphicon glyphicon-search"></span></span>
									<input type="hidden" name="tab" value="2">
									<input type="text" name="exploit" placeholder="Exploit Name" class="form-control no-left-border" id="ExploitSearchBar">
									<button type="submit" class="btn btn-danger" id="ExploitSearchButton">Search</button>
								</div>
							</div>
						</form>
						<div class="alert alert-danger collapse" id="ErrorMessage">
							<span class="glyphicon glyphicon-exclamation-sign"></span>
		    				<a class="close" id="CloseAlert">&times;</a>
		    				<strong>Error!</strong> No Exploits matching the search were found, please try again!
						</div>
					</div>
					<div id="ExploitInformationTable" class="container">
						<div class="panel">
							<div class="panel-heading">
								<h3>Exploit Information</h3>
							</div>
							<table class="table table-bordered table-striped">
								<tr>
									<th scope="row">Exploit:</th>
									<td><?php $Run = new ExploitInformation(); echo $Run->GetExploitName(filter_input(INPUT_GET, "exploit")); ?></td>
								</tr>
								<tr>
									<th scope="row">Type:</th>
									<td><?php $Run = new ExploitInformation(); echo $Run->GetExploitType(filter_input(INPUT_GET, "exploit")); ?></td>
								</tr>
								<tr>
									<th scope="row">Desription:</th>
									<td><?php $Run = new ExploitInformation(); echo $Run->GetExploitDescription(filter_input(INPUT_GET, "exploit")); ?></td>
								</tr>
								<tr>
									<th scope="row">Price:</th>
									<td><?php $Run = new ExploitInformation(); echo $Run->GetExploitPrice(filter_input(INPUT_GET, "exploit")); ?></td>
								</tr>
								<tr>
									<th scope="row">Status:</th>
									<td><?php $Run = new ExploitInformation(); echo $Run->GetExploitStatus(filter_input(INPUT_GET, "exploit")); ?></td>
								</tr>
								<tr>
									<th scope="row">Author:</th>
									<td><?php $Run = new ExploitInformation(); echo $Run->GetExploitAuthor(filter_input(INPUT_GET, "exploit")); ?></td>
								</tr>
								<tr>
									<th scope="row">Thread:</th>
									<td><?php $Run = new ExploitInformation(); echo $Run->GetExploitThread(filter_input(INPUT_GET, "exploit")); ?></td>
								</tr>
							</table>
						</div>
					</div>
				</center>
			</div>
			<div id="SocialTab" class="collapse">
					<div id="SocialMedia" class="container">
							<ul class="Instagram">
									<li><a id="InstagramBtn"><span class="glyphicon glyphicon-phone"></span> Instagram</a></li>
							</ul>
					</div>
			</div>
		</div>
	</body>
	<script src="Resources/JS/particles.js"></script>
</html>
